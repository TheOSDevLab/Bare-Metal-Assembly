# `01h`

## Key Topics

- [Introduction](#introduction)
    - [Behavior](#behavior)
- [Register Breakdown](#register-breakdown)
- [Examples](#examples)

---

## Introduction

BIOS interrupt 15h function 24h subfunction 01h provides a standardized mechanism for enabling the A20 address line, allowing the processor to access memory beyond the 1MB boundary. This function is essential during the transition from real mode to protected mode, as it removes the address wrap-around limitation of the original IBM PC architecture. It is most commonly used in bootloaders, operating system kernels, and system initialization code to prepare the memory environment for protected mode operation.

### Behavior

When invoked, this function directs the BIOS to activate the A20 gate, allowing the 21st address line to carry its true signal. This enables the processor to access the full 4GB address space in protected mode without memory wrap-around at the 1MB boundary. The BIOS implementation transparently handles the hardware-specific details, which may involve programming the keyboard controller, manipulating the system control port (Fast A20), or using other platform-specific enablement methods.

The function sets the carry flag on failure, with specific error codes indicating the nature of the problem. Common failures occur on systems with locked keyboard controllers, unsupported BIOS implementations, or modern hardware where A20 control is no longer implemented. Successful execution does not guarantee immediate A20 enablement in all cases, as some hardware implementations may require additional time for the change to take effect.

---

## Register Breakdown

- `AH`: Main function number (`24h`) for A20 gate control
- `AL`: Subfunction selector (`01h`) specifically for enabling A20
- Other general-purpose registers are typically preserved

**Return registers:**
- `CF`: Carry Flag - Set to 1 on error, clear (0) on success
- `AH`: Error code (if CF=1) - `01h` indicates keyboard controller locked, `86h` indicates function not supported

---

## Examples

### Basic Usage

```asm
mov ax, 0x2401  ; AH=24h (A20 function), AL=01h (enable)
int 0x15        ; Call BIOS
jc a20_error    ; Jump if carry set (error occurred)
```

This minimal code sequence attempts to enable the A20 gate through the BIOS interface. If successful, the system can properly access memory above 1MB. If failed, control transfers to an error handler to implement alternative enablement strategies.

### Extended Example

```asm
; Complete A20 enablement routine with verification
enable_a20_with_verification:
    ; First attempt BIOS method
    mov ax, 0x2401      ; Function: enable A20
    int 0x15
    jnc .verify         ; If no error, verify enablement
    
    ; BIOS method failed, try Fast A20
    call enable_a20_fast
    jnc .verify
    
    ; Fall back to keyboard controller
    call enable_a20_keyboard
    
.verify:
    call check_a20_status
    jc .success
    ; A20 still not enabled - critical error
    mov si, a20_critical_error
    call print_string
    jmp $
    
.success:
    ret

enable_a20_fast:
    in al, 0x92
    or al, 0x02
    out 0x92, al
    ret

a20_critical_error db "A20 enablement failed - system halted", 0
```

This comprehensive example demonstrates a robust A20 enablement strategy that attempts multiple methods and includes verification. The routine tries the BIOS method first, then falls back to hardware-specific approaches if needed, finally verifying that A20 is actually enabled before proceeding.

### Special Case

```asm
; Optimized A20 enablement with pre-check
mov ax, 0x2403      ; Query A20 support
int 0x15
jc use_hardware     ; BIOS doesn't support A20 functions

test bl, 0x04       ; Check bit 2: BIOS A20 control supported
jz use_hardware     ; Use hardware methods if BIOS control unavailable

; BIOS control is available and preferred
mov ax, 0x2401      ; Enable A20 via BIOS
int 0x15
jnc a20_enabled     ; Success - proceed

use_hardware:
    ; BIOS method failed or unavailable, use direct hardware
    call enable_a20_fast_method
    
a20_enabled:
    ; Continue with protected mode setup
```

This special case demonstrates the optimal approach of checking for BIOS A20 support before attempting enablement. By using the query function first, the code can avoid unnecessary errors and select the most appropriate enablement method for the specific platform, improving compatibility and reliability across different systems.

---
