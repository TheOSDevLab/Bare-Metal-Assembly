# `03h`

> This file may contain outdated or incomplete information. Please verify any important details before using them in your implementation. For the reasoning behind this, see [this file](investigating_03h.md).

## Key Topics

- [Introduction](#introduction)
  - [Behavior](#behavior)
- [Register Breakdown](#register-breakdown)
- [Examples](#examples)
- [Implementation Notes](#implementation-notes)

---

## Introduction

BIOS interrupt 15h function 24h subfunction 03h (`INT 15h, AH=24h, AL=03h`) is used to **query whether BIOS A20 gate control functions are supported** on the current system.  

Subfunction `03h` acts as a *probe*: it allows software to safely determine whether the BIOS supports the A20 control functions (subfunctions `00h-02h`) before attempting to call them. On success, it may also return the **current A20 gate state** in register `BL`.

### Behavior

When invoked, this function performs a support query for the BIOS A20 control interface.

- If the **carry flag (CF)** is **set**, the BIOS does **not** support A20 gate control functions.  
- If the **carry flag (CF)** is **clear**, the BIOS **does** support them, and `BL` may contain the current A20 gate status.

This call is safe on all x86-compatible systems, including those without A20 BIOS support.

---

## Register Breakdown

### Input Registers

| Register | Value | Description |
|-----------|--------|-------------|
| `AH` | `24h` | A20 gate control function class |
| `AL` | `03h` | Subfunction: Query A20 support |

### Output Registers

| Register | Value / Meaning |
|-----------|-----------------|
| `CF` | **0** = BIOS supports A20 gate control functions<br>**1** = Function not supported |
| `BL` | (if CF=0) Bit 0 reflects current A20 state:<br> • 1 = A20 enabled<br> • 0 = A20 disabled |
| `AH` | Undefined if CF=0<br>`86h` if CF=1 (function not supported) |
| Others | Undefined |

---

## Examples

### Basic Usage

```asm
; Query if BIOS A20 control functions are supported
mov ax, 0x2403
int 0x15
jc .no_support        ; CF=1 → BIOS does not support A20 functions

; CF=0 → Supported
test bl, 1            ; Optional: Check current A20 state
jnz .a20_enabled
jmp .a20_disabled

.no_support:
    ; Fallback: use hardware control (port 0x92 or 8042)
    jmp .done

.a20_enabled:
    ; A20 line is active
    jmp .done

.a20_disabled:
    ; A20 line is inactive, can use INT 15h/AX=2401h to enable
.done:
```

---

## Implementation Notes

* **Purpose:**
  The primary purpose of this subfunction is to **detect BIOS support** for A20 management. It should be called before using subfunctions `00h-02h` to avoid undefined behavior on older systems.
* **Redundancy with AL=02h:**
  While `AL=02h` also reports the current A20 state, it assumes BIOS A20 functions already exist. Subfunction `03h` is the *safe detection mechanism* to determine if those functions are implemented at all.
* **Compatibility:**
  Implemented on IBM PS/2 systems and compatible BIOSes (Phoenix, AMI, SeaBIOS).
  Returns CF=1 on legacy XT-class systems and minimal BIOSes without A20 support.
* **Practical Use in Modern Emulators:**
  QEMU’s SeaBIOS fully implements this function. It always clears CF (supported) and reports the current A20 state in BL bit 0.

---
