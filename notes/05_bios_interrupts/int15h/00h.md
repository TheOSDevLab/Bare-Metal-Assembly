# `00h`

## Key Topics

- [Introduction](#introduction)
    - [Behavior](#behavior)
- [Register Breakdown](#register-breakdown)
- [Examples](#examples)

---

## Introduction

BIOS interrupt 15h, function 24h, subfunction 00h provides a standardized interface for **disabling the A20 address line**. This service was introduced to maintain backward compatibility with legacy software written for the original IBM PC, which featured a 20-bit address bus. When the A20 line is disabled, memory accesses above the 1 MB boundary wrap around to the start of conventional memory; mimicking the addressing behavior of early PCs.

This function is used during **system initialization**, **hardware compatibility tests**, and particularly when reverting from **protected mode** back to **real mode**. It allows the operating system or bootloader to ensure that memory behaves consistently with the 8086 model when required.

### Behavior

When called, the BIOS attempts to **disable the A20 gate**; forcing the 21st address line (A20) low. This effectively masks any memory address bit beyond the first 20, causing physical memory at addresses `0x100000` and higher to alias back to addresses starting at `0x00000`.

The exact hardware implementation varies:
- On legacy systems, this may involve toggling bit 2 of the **keyboard controller output port**.
- On newer AT-class machines, the BIOS may instead use **System Control Port A (port 92h)**.
- On modern systems, the A20 gate may be permanently enabled or emulated, and the call may return success even though no actual gating occurs.

If the BIOS or chipset does not support A20 control, the function fails and sets the carry flag.

---

## Register Breakdown

**Input:**
- `AH` = `24h`; A20 control function
- `AL` = `00h`; Subfunction: Disable A20 gate  
- Other registers: Undefined (should not be relied upon)

**Output:**
- `CF` = 0 → Success  
- `CF` = 1 → Failure  
- `AH` = Status/Error code (valid if `CF=1`):
  - `01h`; Keyboard controller locked or in secure mode
  - `86h`; Function not supported

**Notes:**
- Only the documented registers (`AH`, `CF`) are guaranteed to be valid after return.
- Many BIOS implementations preserve general-purpose registers, but this is not guaranteed.

---

## Related Subfunctions

| Subfunction (AL) | Purpose                      |
|------------------:|------------------------------|
| `00h`            | Disable A20 gate             |
| `01h`            | Enable A20 gate              |
| `02h`            | Query current A20 state      |
| `03h`            | Query A20 support and method |

When checking for A20 support, call subfunction `03h` first. This ensures that BIOS-provided A20 control exists and prevents unnecessary error handling.

---

## Examples

### Basic Usage

```asm
mov ax, 0x2400      ; AH=24h (A20 function), AL=00h (disable A20)
int 0x15            ; BIOS call
jc  error_handler   ; Jump if carry flag set (error)
````

This code disables the A20 gate using the BIOS interface. On failure, control is transferred to an error handler to attempt alternative hardware control methods.

---

### Extended Example

```asm
; Disable A20 with fallback and error reporting
disable_a20_bios:
    mov ax, 0x2403          ; Check for BIOS A20 support
    int 0x15
    jc  no_bios_support      ; BIOS doesn't implement A20 functions

    test bl, 0x02            ; Bit 1: BIOS A20 control available
    jz  no_bios_control       ; BIOS cannot control A20

    mov ax, 0x2400           ; Disable A20 gate
    int 0x15
    jc  bios_error            ; Operation failed

    ret

no_bios_support:
    ; Handle missing BIOS support (fallback to hardware method)
no_bios_control:
    ; Handle lack of BIOS A20 control
bios_error:
    ; Report failure, fallback to port 92h or KBC control
```

This routine performs a **capability check** before disabling A20. It gracefully handles missing or unsupported BIOS implementations and provides structured fallbacks.

---

### Practical Notes

* Modern BIOS implementations may **ignore** A20 control requests and always report success. This is expected behavior on systems where the A20 gate is permanently enabled.
* For robust OS initialization, always include **fallback mechanisms**:

  * **Port 92h method**; toggle bit 1 of port 92h.
  * **Keyboard controller method**; toggle bit 2 of the 8042 output port.
* Avoid depending solely on BIOS calls in long-term kernel code; once you switch to protected or long mode, hardware control should be handled directly by the OS.

---
