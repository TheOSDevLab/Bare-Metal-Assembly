# `02h`

## Key Topics

- [Introduction](#introduction)
    - [Behavior](#behavior)
- [Register Breakdown](#register-breakdown)
- [Examples](#examples)
- [References](#references)

---

## Introduction

BIOS Interrupt 13h Function 02h is the fundamental disk read service that reads one or more sectors from a storage device into memory. It exists to provide low-level disk access during system bootstrapping and in real-mode environments before operating system drivers are available. This function is commonly used by bootloaders to load additional stages of the boot process, operating system kernels, and system utilities from disk into memory.

### Behavior

The function reads the specified number of sectors starting from a given CHS (Cylinder-Head-Sector) location and transfers the data to a memory buffer. It performs error checking and sets the carry flag to indicate success or failure. On successful completion, the sectors are copied to the specified memory location. If an error occurs, the carry flag is set and AH contains an error code. Key limitations include the 504 MB barrier due to CHS addressing constraints and the requirement that the entire transfer must fit within a single 64KB memory segment.

---

## Register Breakdown

- `AH`: Function number (`02h`)
- `AL`: Number of sectors to read (1-128)
- `CH`: Cylinder number (lower 8 bits, 0-255)
- `CL`: Sector number (bits 0-5) and cylinder high bits (bits 6-7)
- `DH`: Head number (0-255)
- `DL`: Drive number (0x80 for first HDD, 0x00 for first FDD)
- `ES:BX`: Segment:Offset pointer to destination buffer

**Notes:**

  - The cylinder number uses 10 bits total (CL bits 6-7 + CH).
  - Sector numbering starts at 1, not 0.
  - The carry flag (CF) indicates success (0) or failure (1), with error codes returned in AH.

---

## Examples

### Basic Usage

```asm
mov ah, 0x02
mov al, 1
mov ch, 0
mov cl, 1
mov dh, 0
mov dl, 0x80
mov bx, 0x0000
mov es, bx
mov bx, 0x7E00
int 0x13
```

This reads one sector from cylinder 0, head 0, sector 1 (typically the boot sector) of the first hard drive into memory at 0000:7E00.

### Extended Example

```asm
; Load multiple sectors for a kernel
mov ax, 0x1000
mov es, ax        ; Segment for kernel
mov bx, 0x0000    ; Offset 0
mov ah, 0x02      ; Read function
mov al, 0x10      ; Read 16 sectors (8KB)
mov ch, 0x00      ; Cylinder 0
mov cl, 0x02      ; Start from sector 2
mov dh, 0x00      ; Head 0
mov dl, 0x80      ; First hard drive

load_sectors:
    int 0x13
    jc disk_error ; Jump if carry set (error)
    ; Continue with kernel execution...

disk_error:
    ; Handle disk read error
    lea si, [error_msg]
    call print_string
    hlt

error_msg db "Disk read error!", 0
```

This example loads 16 consecutive sectors (8KB) starting from cylinder 0, head 0, sector 2 into memory at segment 1000h. It includes basic error handling for disk read failures.

### Special Case

```asm
mov ah, 0x02
mov al, 0x80      ; Maximum sectors per call (128)
mov ch, 0x4F      ; High cylinder (79)
mov cl, 0x01      ; Sector 1, cylinder bits 8-9 = 0
mov dh, 0xFE      ; Second-to-last head (254)
mov dl, 0x80
mov bx, 0x2000
mov es, bx
mov bx, 0x0000
int 0x13
```

This demonstrates reading the maximum number of sectors (128) in a single call, accessing sectors near the CHS limit of early BIOS implementations. The 128 sectors represent 64KB of data, which is the maximum that can fit in a single segment without segment wrapping.

---

## References

+ For a detailed explanation of the 128-sector limit, please refer to [this document](../../../Q&A/11_sector_count_limit.md).
+ To understand the 504 MB barrier and its technical basis, consult [this analysis](../../../Q&A/12_504mb_barrier.md).

---
